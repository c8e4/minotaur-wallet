{"version":3,"file":"scripts/injector.js","mappings":"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","sources":["../node_modules/@babel/runtime/helpers/esm/defineProperty.js","../node_modules/@babel/runtime/helpers/esm/objectSpread2.js","../node_modules/uuid/dist/esm-browser/rng.js","../node_modules/uuid/dist/esm-browser/regex.js","../node_modules/uuid/dist/esm-browser/validate.js","../node_modules/uuid/dist/esm-browser/stringify.js","../node_modules/uuid/dist/esm-browser/v4.js","connector/service/chrome/injector.ts"],"sourcesContent":["export default function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}","import defineProperty from \"./defineProperty.js\";\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nexport default function _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n\n  return target;\n}","// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nvar getRandomValues;\nvar rnds8 = new Uint8Array(16);\nexport default function rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation. Also,\n    // find the complete implementation of crypto (msCrypto) on IE11.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto !== 'undefined' && typeof msCrypto.getRandomValues === 'function' && msCrypto.getRandomValues.bind(msCrypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}","export default /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;","import REGEX from './regex.js';\n\nfunction validate(uuid) {\n  return typeof uuid === 'string' && REGEX.test(uuid);\n}\n\nexport default validate;","import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).substr(1));\n}\n\nfunction stringify(arr) {\n  var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  var uuid = (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase(); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;","import rng from './rng.js';\nimport stringify from './stringify.js';\n\nfunction v4(options, buf, offset) {\n  options = options || {};\n  var rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (var i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return stringify(rnds);\n}\n\nexport default v4;","import { EventData } from '../types';\nimport * as uuid from 'uuid';\n\nconst info: {\n  sessionId: string;\n  port?: chrome.runtime.Port;\n} = {\n  sessionId: uuid.v4(),\n};\n\nconst getPort = () => {\n  if (!info.port) {\n    console.log('new port created');\n    if (!info.sessionId) {\n      info.sessionId = uuid.v4();\n    }\n    info.port = chrome.runtime.connect();\n    info.port.onMessage.addListener((msg: EventData) => {\n      if (msg.type === 'connected') {\n        info.port?.postMessage({\n          type: 'register',\n        });\n      } else {\n        msg.sessionId = info.sessionId;\n        window.postMessage(msg, window.location.origin);\n      }\n    });\n    info.port.onDisconnect.addListener(() => {\n      console.log('disconnected');\n      info.port = undefined;\n    });\n  }\n  return info.port;\n};\n\nfunction shouldInject() {\n  const documentElement = document.documentElement.nodeName;\n  const docElemCheck = documentElement\n    ? documentElement.toLowerCase() === 'html'\n    : true;\n  const { doctype } = window.document;\n  const docTypeCheck = doctype ? doctype.name === 'html' : true;\n  return docElemCheck && docTypeCheck;\n}\n\nconst injectScript = (file_path: string) => {\n  console.log(file_path);\n  const container = document.head || document.documentElement;\n  const script = document.createElement('script');\n  script.setAttribute('async', 'false');\n  script.setAttribute('type', 'text/javascript');\n  script.setAttribute('src', file_path);\n  container.insertBefore(script, container.children[0]);\n  // node.appendChild(script);\n  // node.removeChild(script);\n};\n\nif (shouldInject()) {\n  injectScript(chrome.runtime.getURL('scripts/content.js'));\n} else {\n  console.log('inject not allowed');\n}\n\nwindow.addEventListener('message', (event: MessageEvent<EventData>) => {\n  if (event.data.direction !== 'request') {\n    return;\n  }\n  const data = { ...event.data, sessionId: info.sessionId };\n  getPort().postMessage(data);\n});\n\ngetPort();\n"],"names":["getRandomValues","rnds8","Uint8Array","rng","crypto","bind","msCrypto","Error","REGEX","validate","uuid","test","byteToHex","i","push","toString","substr","stringify","arr","offset","arguments","length","undefined","toLowerCase","TypeError","v4","options","buf","rnds","random","info","sessionId","getPort","port","console","log","chrome","runtime","connect","onMessage","addListener","msg","type","postMessage","window","location","origin","onDisconnect","shouldInject","documentElement","document","nodeName","docElemCheck","doctype","docTypeCheck","name","injectScript","file_path","container","head","script","createElement","setAttribute","insertBefore","children","getURL","addEventListener","event","data","direction"],"sourceRoot":""}